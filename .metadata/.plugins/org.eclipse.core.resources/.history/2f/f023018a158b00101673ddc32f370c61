package com.veterinarska.stanica.repository;

import com.veterinarska.stanica.model.Prijateljstvo;
import com.veterinarska.stanica.model.Korisnik;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

import java.util.List;

public interface PrijateljstvoRepository extends JpaRepository<Prijateljstvo, Long> {

    // --- Provera prijateljstva (po ID) ---
    @Query("""
      select count(p) > 0 from Prijateljstvo p
      where (p.korisnik1.id = :a and p.korisnik2.id = :b)
         or (p.korisnik1.id = :b and p.korisnik2.id = :a)
    """)
    boolean jesuPrijatelji(long a, long b);

    // --- Provera prijateljstva (preko entiteta) ---
    @Query("""
      select count(p) > 0 from Prijateljstvo p
      where (p.korisnik1 = :a and p.korisnik2 = :b)
         or (p.korisnik1 = :b and p.korisnik2 = :a)
    """)
    boolean jesuPrijatelji(Korisnik a, Korisnik b);

    // --- Lista prijatelja (po ID) ---
    @Query("""
      select case when p.korisnik1.id = :userId then p.korisnik2 else p.korisnik1 end
      from Prijateljstvo p
      where p.korisnik1.id = :userId or p.korisnik2.id = :userId
    """)
    List<Korisnik> listaPrijatelja(long userId);

    // --- Lista prijatelja (preko entiteta) ---
    @Query("""
      select case when p.korisnik1 = :korisnik then p.korisnik2 else p.korisnik1 end
      from Prijateljstvo p
      where p.korisnik1 = :korisnik or p.korisnik2 = :korisnik
    """)
    List<Korisnik> listaPrijatelja(Korisnik korisnik);
}
