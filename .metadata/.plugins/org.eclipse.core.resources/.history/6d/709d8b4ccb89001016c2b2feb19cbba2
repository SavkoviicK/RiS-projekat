<%@ page contentType="text/html; charset=UTF-8" language="java" %>
<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Va≈° ljubimac</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:0;background:#f7f9fb;color:#1a1a1a}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;
           padding:16px 24px;background:#fff;border-bottom:1px solid #e6e6e6}
    header img{height:56px}
    nav a{margin-right:14px;text-decoration:none;color:#0b5ed7}

    .hero{
      display:flex;align-items:center;justify-content:space-between;gap:24px;
      padding:40px 24px;
      background:linear-gradient(180deg,#f7faff 0%, #f7f9fb 100%);
      border-bottom:1px solid #e9eef3;
    }
    .hero h1{margin:0 0 8px 0}

    .card{
      background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:18px;
      box-shadow:0 1px 0 rgba(0,0,0,.02);transition:.2s ease;
    }
    .card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:0 24px 32px}

    .btn{
      display:inline-block;background:#0b5ed7;color:#fff;padding:10px 16px;border-radius:8px;
      text-decoration:none;border:0;cursor:pointer;transition:.2s ease
    }
    .btn:hover{filter:brightness(1.05)}

    .section-title{ text-align:center;color:#2b2f33;margin:36px 0 18px;font-weight:700 }
    hr.soft{ border:0;height:1px;background:#eceff3;margin:28px 0 }
    .gallery{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:20px;max-width:1000px;margin:0 auto 28px
    }
    .gallery .tile{
      background:#fff;border:1px solid #e6e6e6;border-radius:12px;overflow:hidden;
      box-shadow:0 1px 0 rgba(0,0,0,.02);transition:.2s ease;text-align:center
    }
    .gallery .tile:hover{transform:translateY(-3px);box-shadow:0 10px 28px rgba(0,0,0,.1)}
    .gallery .tile img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block;transition:.25s ease}
    .gallery .tile:hover img{transform:scale(1.03)}
    .gallery .tile p{margin:10px 12px 12px;color:#444}
  </style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:16px;">
    <img src="${pageContext.request.contextPath}/img/logo.png" alt="Logo">
    <div style="font-weight:700">Veterinarska stanica Va≈° ljubimac</div>
  </div>

  <nav>
    <a href="${pageContext.request.contextPath}/ljubimci">Ljubimci</a>
    <a href="${pageContext.request.contextPath}/pregledi">Pregledi</a>
    <a href="${pageContext.request.contextPath}/poruke">Poruke</a>
    <a id="navIzvestaji" href="${pageContext.request.contextPath}/izvestaji" style="display:none">Izve≈°taji</a>
    <!-- Registracija: prikazuj samo kad korisnik NIJE ulogovan -->
    <span id="navRegistracija"><a href="${pageContext.request.contextPath}/registracija">Registracija</a></span>
  </nav>

  <div id="userBox" style="margin-left:auto;">
    <span id="userInfo"></span>
    <button id="btnLogout" class="btn" style="margin-left:12px;display:none;">Odjava</button>
  </div>
</header>

<section class="hero">
  <div>
    <h1>Dobrodo≈°li üêæ</h1>
    <p>Upravljanje ljubimcima, zakazivanje pregleda i izve≈°taji ‚Äî na jednom mestu.</p>
    <a class="btn" href="${pageContext.request.contextPath}/ljubimci">Zapoƒçni</a>
  </div>
  <div class="card">
    <img src="${pageContext.request.contextPath}/img/logo.png" alt="Ljubimci"
         style="height:140px;display:block;margin:auto">
  </div>
</section>

<section class="grid">
  <div class="card"><h3>üòä Ljubimci</h3><p>Dodaj i ureƒëuj ljubimce.</p></div>
  <div class="card"><h3>üìÖ Pregledi</h3><p>Zaka≈æi i izmeni termine.</p></div>
  <div class="card"><h3>üí¨ Poruke</h3><p>Razmena poruka sa veterinarom.</p></div>
</section>

<hr class="soft">

<h2 class="section-title">Na≈°i ljubimci</h2>

<div class="gallery">
  <div class="tile">
    <img src="${pageContext.request.contextPath}/img/pas.png" alt="Pas">
    <p>Verni prijatelj</p>
  </div>
  <div class="tile">
    <img src="${pageContext.request.contextPath}/img/macka.png" alt="Maƒçka">
    <p>Ponosne maƒçke</p>
  </div>
  <div class="tile">
    <img src="${pageContext.request.contextPath}/img/stetoskop.png" alt="Veterinar">
    <p>Struƒçna nega</p>
  </div>
</div>

<script src="${pageContext.request.contextPath}/js/auth.js"></script>
<script>showAdminMenu && showAdminMenu();</script>

<script>
(function() {
  function formatRole(role) {
    if (!role) return "";
    // prihvati i objekte i plain stringove
    var s = typeof role === 'string' ? role : (role.authority || "");
    return s.replace(/^ROLE_/, ""); // ROLE_ADMIN -> ADMIN
  }

  function paintUserBox() {
    var info = document.getElementById('userInfo');
    var btn  = document.getElementById('btnLogout');
    if (!info || !btn) return;

    var token = localStorage.getItem('jwt');
    var roles = [];
    try { roles = JSON.parse(localStorage.getItem('roles') || "[]"); } catch(e){}

    if (token) {
      var rolesNice = roles.map(formatRole).filter(Boolean);
      var txt = rolesNice.length ? "Prijavljen (" + rolesNice.join(", ") + ")" : "Prijavljen";
      info.textContent = txt;
      btn.style.display = 'inline-block';
      btn.onclick = function(){ logout(); location.href='${pageContext.request.contextPath}/'; };
    } else {
      info.innerHTML = '<a href="${pageContext.request.contextPath}/prijava">Prijavi se</a>';
      btn.style.display = 'none';
    }

    // Registracija link: prika≈æi samo kada NEMA tokena
    var reg = document.getElementById('navRegistracija');
    if (reg) reg.style.display = token ? 'none' : 'inline';
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', paintUserBox);
  } else {
    paintUserBox();
  }
})();
</script>
</body>
</html>
